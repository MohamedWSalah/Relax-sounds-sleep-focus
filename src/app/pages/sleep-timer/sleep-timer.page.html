<!-- Mode Selector & Configuration Section -->
@if (!isRunning() && !isPaused()) {
<div class="mode-selector-section">
  <ion-card class="mode-card">
    <h3 class="section-title">Sleep Timer Mode</h3>

    <ion-segment
      [value]="selectedMode()"
      (ionChange)="onModeChange($event)"
      class="mode-segment"
      mode="ios"
    >
      <ion-segment-button value="manual" class="mode-button">
        <ion-icon name="time-outline"></ion-icon>
        <ion-label>Manual</ion-label>
      </ion-segment-button>
      <ion-segment-button value="inactivity" class="mode-button">
        <ion-icon name="moon-outline"></ion-icon>
        <ion-label>Inactive</ion-label>
      </ion-segment-button>
    </ion-segment>

    <div class="mode-description">
      <ion-icon [name]="modeInfo().icon" class="mode-icon"></ion-icon>
      <div>
        <h4 class="mode-title">{{ modeInfo().title }}</h4>
        <p class="mode-text">{{ modeInfo().description }}</p>
      </div>
    </div>

    <!-- Mode-specific Configuration (Inline) -->
    <div class="mode-configuration">
      <!-- Manual Timer Configuration -->
      @if (selectedMode() === 'manual') {
      <div class="config-divider"></div>
      <div class="config-section">
        <div class="time-inputs">
          <div class="input-group">
            <ion-label>Hours</ion-label>
            <ion-input
              type="number"
              [value]="hours()"
              (ionInput)="onHoursChange($event)"
              placeholder="0"
              min="0"
              max="23"
              class="time-input"
            ></ion-input>
          </div>

          <div class="input-group">
            <ion-label>Minutes</ion-label>
            <ion-input
              type="number"
              [value]="minutes()"
              (ionInput)="onMinutesChange($event)"
              placeholder="30"
              min="0"
              max="59"
              class="time-input"
            ></ion-input>
          </div>

          <div class="input-group">
            <ion-label>Seconds</ion-label>
            <ion-input
              type="number"
              [value]="seconds()"
              (ionInput)="onSecondsChange($event)"
              placeholder="0"
              min="0"
              max="59"
              class="time-input"
            ></ion-input>
          </div>
        </div>

        @if (inputError()) {
        <ion-text color="danger" class="error-message">
          {{ inputError() }}
        </ion-text>
        }
      </div>
      }

      <!-- Inactivity Timer Configuration -->
      @if (selectedMode() === 'inactivity') {
      <div class="config-divider"></div>
      <div class="config-section">
        <h3 class="input-title">Set Inactivity Duration</h3>
        <div class="time-inputs">
          <div class="input-group">
            <ion-label>Hours</ion-label>
            <ion-input
              type="number"
              [value]="inactivityHours()"
              (ionInput)="onInactivityHoursChange($event)"
              placeholder="0"
              min="0"
              max="23"
              class="time-input"
            ></ion-input>
          </div>
          <div class="input-group">
            <ion-label>Minutes</ion-label>
            <ion-input
              type="number"
              [value]="inactivityMinutes()"
              (ionInput)="onInactivityMinutesChange($event)"
              placeholder="10"
              min="0"
              max="59"
              class="time-input"
            ></ion-input>
          </div>
          <div class="input-group">
            <ion-label>Seconds</ion-label>
            <ion-input
              type="number"
              [value]="inactivitySeconds()"
              (ionInput)="onInactivitySecondsChange($event)"
              placeholder="0"
              min="0"
              max="59"
              class="time-input"
            ></ion-input>
          </div>
        </div>
        @if (inputError()) {
        <ion-text color="danger" class="error-message">
          {{ inputError() }}
        </ion-text>
        }
      </div>
      }
    </div>
  </ion-card>
</div>
}

<!-- Manual Mode: Circular Countdown Timer (Only when running) -->
@if (selectedMode() === 'manual' && (isRunning() || isPaused())) {
<div class="timer-display-section">
  <div class="countdown-container">
    <!-- SVG Circular Progress -->
    <svg class="countdown-circle" viewBox="0 0 100 100">
      <!-- Background circle -->
      <circle
        cx="50"
        cy="50"
        r="45"
        fill="none"
        stroke="rgba(255, 255, 255, 0.1)"
        stroke-width="8"
      />
      <!-- Progress circle -->
      <circle
        cx="50"
        cy="50"
        r="45"
        fill="none"
        stroke="#6fffe9"
        stroke-width="8"
        stroke-linecap="round"
        stroke-dasharray="283"
        [attr.stroke-dashoffset]="283 - (283 * progressPercentage() / 100)"
        class="progress-circle"
      />
    </svg>

    <!-- Timer Display -->
    <div class="timer-display">
      <div class="time-text">{{ displayTime().formatted }}</div>
      @if (isRunning() && !isPaused()) {
      <div class="status-text">Running</div>
      } @else if (isPaused()) {
      <div class="status-text paused">Paused</div>
      }
    </div>
  </div>
</div>
}

<!-- Manual Timer Control Buttons -->
@if (selectedMode() === 'manual') {
<div class="control-buttons">
  <ion-grid>
    <ion-row>
      @if (!isRunning() && !isPaused()) {
      <ion-col size="12">
        <ion-button
          expand="block"
          fill="solid"
          [disabled]="!canStart()"
          (click)="startTimer()"
          class="control-button start-button"
        >
          <ion-icon name="play" slot="start"></ion-icon>
          Start Timer
        </ion-button>
      </ion-col>
      } @else {
      <ion-col size="6">
        @if (canPause()) {
        <ion-button
          expand="block"
          fill="outline"
          (click)="pauseTimer()"
          class="pause-button control-button"
        >
          <ion-icon name="pause" slot="start"></ion-icon>
          Pause
        </ion-button>
        } @else {
        <ion-button
          expand="block"
          fill="solid"
          color="success"
          (click)="resumeTimer()"
          class="control-button resume-button"
        >
          <ion-icon name="play" slot="start"></ion-icon>
          Resume
        </ion-button>
        }
      </ion-col>

      <ion-col size="6">
        <ion-button
          expand="block"
          fill="outline"
          color="danger"
          (click)="resetTimer()"
          class="control-button reset-button"
        >
          <ion-icon name="stop" slot="start"></ion-icon>
          Reset
        </ion-button>
      </ion-col>
      }
    </ion-row>
  </ion-grid>
</div>
}

<!-- Smart Timer Modes: Status Display (When Active) -->
@if (selectedMode() === 'inactivity' && isRunning()) {
<div class="smart-timer-status-section">
  <div class="status-card monitoring">
    <ion-icon name="pulse-outline" class="status-icon pulse"></ion-icon>
    <h3 class="status-title">Monitoring Active</h3>
    <p class="status-description">
      @if (inactivityHours() > 0) { Stops after {{ inactivityHours() }}h {{
      inactivityMinutes() }}m {{ inactivitySeconds() }}s of screen being off }
      @else if (inactivityMinutes() > 0) { Stops after {{ inactivityMinutes()
      }}m {{ inactivitySeconds() }}s of screen being off } @else { Stops after
      {{ inactivitySeconds() }}s of screen being off }
    </p>
  </div>
</div>
}

<!-- Control Buttons for Smart Timer Modes -->
@if (selectedMode() === 'inactivity') {
<div class="control-buttons">
  <ion-grid>
    <ion-row>
      @if (!isRunning()) {
      <ion-col size="12">
        <ion-button
          expand="block"
          fill="solid"
          (click)="startTimer()"
          class="control-button start-button"
        >
          <ion-icon name="play" slot="start"></ion-icon>
          Start
        </ion-button>
      </ion-col>
      } @else {
      <ion-col size="12">
        <ion-button
          expand="block"
          fill="outline"
          color="danger"
          (click)="resetTimer()"
          class="control-button stop-button"
        >
          <ion-icon name="stop" slot="start"></ion-icon>
          Stop
        </ion-button>
      </ion-col>
      }
    </ion-row>
  </ion-grid>
</div>
}

<!-- Completion Message -->
@if (showCompletionMessage()) {
<div class="completion-message">
  <ion-card class="completion-card">
    <div class="completion-content">
      <div class="completion-icon">âœ¨</div>
      <h3 class="completion-title">Timer Complete</h3>
      <p class="completion-text">
        Your timer has ended. All sounds have been stopped.
      </p>
    </div>
  </ion-card>
</div>
}
