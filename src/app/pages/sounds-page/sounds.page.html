<!-- Categories -->
<div class="categories-container">
  <div class="categories-row" #categoriesRow>
    @for (category of categories(); track category.id) {
    <button
      class="category-btn"
      [class.active]="selectedCategory() === category.id"
      (click)="selectCategory(category.id)"
      [attr.data-category-id]="category.id"
    >
      {{ category.icon }}
      <span>{{ category.name }}</span>
    </button>
    }
  </div>
</div>
<!-- Subcategories -->
@if (currentSubcategories()) {
<div class="subcategories-container">
  <div class="subcategories-row">
    <button
      class="subcategory-btn"
      [class.active]="selectedSubcategory() === null"
      (click)="selectSubcategory(null)"
    >
      All
    </button>
    @for (subcategory of currentSubcategories(); track subcategory.id) {
    <button
      class="subcategory-btn"
      [class.active]="selectedSubcategory() === subcategory.id"
      (click)="selectSubcategory(subcategory.id)"
    >
      {{ subcategory.name }}
    </button>
    }
  </div>
</div>
}

<!-- Gesture Hint Arrows -->
@if (showGestureHints()) {
<div class="gesture-hints">
  <div class="hint-arrow hint-left">
    <ion-icon name="chevron-back"></ion-icon>
  </div>
  <div class="hint-arrow hint-right">
    <ion-icon name="chevron-forward"></ion-icon>
  </div>
</div>
}

<!-- Active Swipe Feedback -->
@if (swipeStarted()) {
<div class="swipe-feedback">
  @if (isSwipingLeft()) {
  <div
    class="swipe-arrow swipe-left"
    [style.opacity]="swipeProgress()"
    [style.transform]="'translateX(-' + (swipeProgress() * 30) + 'px) scale(' + (0.8 + swipeProgress() * 0.4) + ')'"
  >
    <ion-icon name="chevron-forward"></ion-icon>
  </div>
  } @if (isSwipingRight()) {
  <div
    class="swipe-arrow swipe-right"
    [style.opacity]="swipeProgress()"
    [style.transform]="'translateX(' + (swipeProgress() * 30) + 'px) scale(' + (0.8 + swipeProgress() * 0.4) + ')'"
  >
    <ion-icon name="chevron-back"></ion-icon>
  </div>
  }
</div>
}

<!-- Sound Grid with Gesture Support -->
<div
  class="sound-grid"
  (touchstart)="onTouchStart($event)"
  (touchmove)="onTouchMove($event)"
  (touchend)="onTouchEnd($event)"
>
  @if (showActiveEmptyState()) {
  <!-- Empty State for Active Category -->
  <div class="empty-state">
    <div class="empty-state-icon">üéµ</div>
    <div class="empty-state-text">Any playing sounds will be visible here</div>
  </div>
  } @else if (showFavoritesEmptyState()) {
  <!-- Empty State for Favorites Category -->
  <div class="empty-state">
    <div class="empty-state-icon">‚ù§Ô∏è</div>
    <div class="empty-state-text">Any favorite sounds will be visible here</div>
  </div>
  } @else { @for (sound of filteredSounds(); track sound.id) {
  <div class="sound-item">
    <!-- Compact Sound Card -->
    <div
      class="sound-card"
      [class]="{
            'selected': sound.selected,
            'premium': sound.premium,
            'locked': isSoundLocked(sound)
          }"
      (click)="toggleSound(sound)"
    >
      @if (isSoundLocked(sound)) {
      <div class="premium-badge locked">
        <ion-icon name="lock-closed"></ion-icon>
      </div>
      } @else if (sound.premium && isPremiumUnlocked()) {
      <div class="premium-badge unlocked">
        <ion-icon name="diamond"></ion-icon>
      </div>
      }

      <!-- Heart Icon for Favorites -->
      <div
        class="favorite-heart"
        [class.favorited]="isFavorite(sound.id)"
        (click)="toggleFavorite(sound, $event)"
      >
        <ion-icon
          [name]="isFavorite(sound.id) ? 'heart' : 'heart-outline'"
          class="heart-icon"
        ></ion-icon>
      </div>

      <div class="sound-icon">
        <span>{{ sound.icon }}</span>
      </div>
      <div class="sound-name">{{ sound.name }}</div>
    </div>

    <!-- Reserved Space for Sound Bar -->
    <div class="sound-bar-container">
      @if (sound.selected) {
      <div class="sound-bar" (click)="$event.stopPropagation()">
        <ion-range
          class="volume-slider"
          min="0"
          max="100"
          [value]="sound.volume * 100"
          (ionChange)="setVolume(sound, $event.detail.value)"
          (click)="$event.stopPropagation()"
        >
        </ion-range>
      </div>
      } @else {
      <div class="sound-bar-placeholder"></div>
      }
    </div>
  </div>
  } }
</div>

<!-- Save Mix Floating Button -->
@if (hasPlayingSounds()) {
<button class="save-mix-fab" (click)="openSaveMixModal()">
  <ion-icon name="bookmark-outline" class="fab-icon"></ion-icon>
</button>
}
